{%- liquid
  assign section_width   = section.settings.width
  assign text_color      = section.settings.text_color
  assign bg_color_secondary = section.settings.bg_color_secondary

  assign heading         = section.settings.left_heading
  assign body            = section.settings.left_body
  assign btn_text        = section.settings.left_button_text
  assign btn_link        = section.settings.left_button_link
  assign btn_color       = section.settings.button_color
  assign btn_style       = section.settings.button_style
  assign btn_size        = section.settings.button_size

  assign blog            = blogs[section.settings.blog]
  assign show_author     = section.settings.show_author
  assign show_date       = section.settings.show_date
  assign show_tags       = section.settings.show_tags

  assign id              = 'TwoColLatestBlog--' | append: section.id
  assign selector_id     = '#' | append: id

  assign animations_enabled = settings.animations_enabled
  assign animation_anchor   = selector_id
  assign animation_delay    = 150

  # image sizing for cards if your item snippet uses sizes
  assign sizes = '(min-width: 1024px) 400px, (min-width: 768px) 50vw, 100vw'
-%}

{%- style -%}
  {{ selector_id }} {
    --PT: {{ section.settings.padding_top }}px;
    --PB: {{ section.settings.padding_bottom }}px;
    background: #f2f1ed;
    margin: 20px 0;
  }
  {%- if bg_color_secondary -%}
    {{ selector_id }} { --bg: var(--bg-secondary); }
  {%- endif -%}

  {{ selector_id }} .two-col {
    display: flex;
    align-items: center;
    gap: 40px;
  }
  {{ selector_id }} .two-col .two-col__left {
    flex: 0 0 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 0 2rem;
  }
  {{ selector_id }} .two-col .two-col__left .h3 {
    margin-bottom: 35px;
  }
  {{ selector_id }} .two-col .two-col__right {
    flex: 0 0 50%;
    margin: auto;
    display: flex;
    justify-content: center;
  }
  {{ selector_id }} .posts {
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 300px;
    gap: 20px;
  }
  @media (max-width: 989px) {
    {{ selector_id }} .two-col { 
      flex-direction: column;
      gap: 2rem;
    }
  }
  @media (max-width: 989px) {
    {{ selector_id }} .two-col .two-col__right {
      flex-direction: column;
      align-items: center;
      gap: 4rem;
    }
    .rte p {
      font-size: 15px;
    }
    {{ selector_id }} .posts {
      gap: 20px !important;
    }
  }

  {{ selector_id }} .two-col__left .content > *:not(:last-child) { margin-bottom: 16px; }

{%- endstyle -%}

<section id="{{ id }}" class="section-padding two-col-latest-blog {{ text_color }}{%- render 'button-fallback-classes', primary_color: btn_color, bg_color_secondary: bg_color_secondary -%}">
  <div class="{{ section_width }}">
    <div class="two-col">
      <!-- Left column -->
      <div class="two-col__left">
        <div class="content">
          {%- if heading != blank -%}
            <h2 class="h3"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
            >{{ heading }}<sup>TM</sup></h2>
          {%- endif -%}

          {%- if body != blank -%}
            <div class="rte"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
            >
              {{ body }}
            </div>
          {%- endif -%}

          {%- if btn_text != blank and btn_link != blank -%}
            <div
              class="hide-mob hide-tablet"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
            >
              <a href="{{ btn_link }}" class="btn {{ btn_style }} {{ btn_size }} {{ btn_color }}">{{ btn_text }}</a>
            </div>
          {%- endif -%}
        </div>
      </div>

      <!-- Right column: latest 3 posts -->
      <div class="two-col__right">
        <div class="posts">
          {%- if blog and blog.articles_count > 0 -%}
            {%- for article in blog.articles limit: 3 -%}
              {%- assign animation_delay = 150 | times: forloop.index -%}
              {%- comment -%}
                Prefer using your existing blog card snippet for consistency:
              {%- endcomment -%}
              {%- render 'blog-post-grid-item',
                article: article,
                article_style: 'standard',
                img_sizes: sizes,
                classes: 'mobile--one-whole',
                animation_anchor: animation_anchor,
                animation_delay: animation_delay,
                default_color: 'none',
                default_image: nil,
                show_author: show_author,
                show_date: show_date,
                show_tags: show_tags,
                show_comments_count: false,
                onboarding: false
              -%}
              {%- comment -%}
                If you don't have 'blog-post-grid-item', replace the render above
                with your own minimal card markup for the article.
              {%- endcomment -%}
            {%- endfor -%}
          {%- else -%}
            {%- for i in (1..3) -%}
              <article class="blog-card onboarding">
                <div style="aspect-ratio: 16/9; background: var(--bg-secondary);"></div>
                <h3 class="h5" style="margin:10px 0 0;">Blog post title</h3>
                <p class="muted" style="margin:6px 0 0;">Preview text goes here.</p>
              </article>
            {%- endfor -%}
          {%- endif -%}
        </div>
        {%- if btn_text != blank and btn_link != blank -%}
            <div
              class="hide-l-desk"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
            >
              <a href="{{ btn_link }}" class="btn {{ btn_style }} {{ btn_size }} {{ btn_color }}">{{ btn_text }}</a>
            </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Latest Blog",
  "settings": [
    { "type": "header", "content": "Left column" },
    { "type": "text", "id": "left_heading", "label": "Heading", "default": "Stay in the loop" },
    { "type": "richtext", "id": "left_body", "label": "Body", "default": "<p>Short description about your blog or brand news.</p>" },
    { "type": "url", "id": "left_button_link", "label": "Button link" },
    { "type": "text", "id": "left_button_text", "label": "Button text", "default": "View all posts" },

    { "type": "header", "content": "Button style" },
    {
      "type": "select",
      "id": "button_color",
      "label": "Button color",
      "default": "btn--black",
      "options": [
        { "label": "Primary", "value": "btn--primary" },
        { "label": "Secondary", "value": "btn--secondary" },
        { "label": "White", "value": "btn--white" },
        { "label": "Black", "value": "btn--black" }
      ]
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button style",
      "default": "btn--solid",
      "options": [
        { "label": "Solid", "value": "btn--solid" },
        { "label": "Outline", "value": "btn--outline" },
        { "label": "Solid with border", "value": "btn--solid-border" },
        { "label": "Text", "value": "btn--text" }
      ]
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "Size",
      "default": "btn--small",
      "options": [
        { "label": "Large", "value": "btn--large" },
        { "label": "Medium", "value": "btn--medium" },
        { "label": "Small", "value": "btn--small" }
      ]
    },

    { "type": "header", "content": "Right column (blog)" },
    { "type": "blog", "id": "blog", "label": "Blog" },
    { "type": "checkbox", "id": "show_author", "label": "Show author", "default": false },
    { "type": "checkbox", "id": "show_date", "label": "Show date", "default": true },
    { "type": "checkbox", "id": "show_tags", "label": "Show tags", "default": false },

    { "type": "header", "content": "Colors" },
    {
      "type": "select",
      "id": "text_color",
      "label": "Text color",
      "default": "text-dark",
      "options": [
        { "value": "text-light", "label": "Light" },
        { "value": "text-dark", "label": "Dark" }
      ]
    },
    { "type": "checkbox", "id": "bg_color_secondary", "label": "Background", "default": false, "info": "Use secondary background color" },

    { "type": "header", "content": "Section spacing" },
    {
      "type": "select",
      "id": "width",
      "label": "Width",
      "default": "wrapper",
      "options": [
        { "value": "wrapper--narrow", "label": "Page width narrow" },
        { "value": "wrapper", "label": "Page width" },
        { "value": "wrapper--full-padded", "label": "Full width padded" }
      ]
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    }
  ],
  "presets": [
    { 
      "name": "Latest Blog", 
      "category": "Blog" 
    }
  ],
  "disabled_on": { "groups": ["header","aside","footer"] }
}
{% endschema %}
